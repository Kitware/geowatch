
TO_EVALUATE = [
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TA1_raw_v54/pred_BAS_smt_it_stm_p8_TA1_raw_v54_epoch=13-step=242605/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TA1_raw_v54/pred_BAS_smt_it_stm_p8_TA1_raw_v54_epoch=26-step=467882/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TA1_raw_v54/pred_BAS_smt_it_stm_p8_TA1_raw_v54_epoch=5-step=103973/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64/pred_BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64_epoch=44-step=92159/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64/pred_BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64_epoch=65-step=135167/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64/pred_BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64_epoch=7-step=16383/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64/pred_BOTH_smt_it_stm_p8_TA1_RAW_scratch_v64_epoch=8-step=18431/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v61/pred_BOTH_smt_it_stm_p8_TA1_RAW_v61_epoch=33-step=69631/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v61/pred_BOTH_smt_it_stm_p8_TA1_RAW_v61_epoch=71-step=147455/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=15-step=32767/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=16-step=34815/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=18-step=38911/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=23-step=49151/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=30-step=63487/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=32-step=67583/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=35-step=73727/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=42-step=88063/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_TA1_RAW_v62/pred_BOTH_smt_it_stm_p8_TA1_RAW_v62_epoch=5-step=12287/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json'
]


TO_EVALUATE = [
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_L1_raw_v48/pred_BAS_smt_it_stm_p8_L1_raw_v48_epoch=20-step=815282/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_L1_raw_v53/pred_BAS_smt_it_stm_p8_L1_raw_v53_epoch=15-step=340047/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_L1_raw_v53/pred_BAS_smt_it_stm_p8_L1_raw_v53_epoch=3-step=85011/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TA1_raw_v54/pred_BAS_smt_it_stm_p8_TA1_raw_v54_epoch=5-step=103973/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_DIL_v57/pred_BAS_smt_it_stm_p8_TUNE_L1_DIL_v57_epoch=3-step=81135/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_DIL_v57/pred_BAS_smt_it_stm_p8_TUNE_L1_DIL_v57_epoch=4-step=101419/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_I2L8_v59/pred_BAS_smt_it_stm_p8_TUNE_L1_I2L8_v59_epoch=1-step=31531/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_I2L8_v59/pred_BAS_smt_it_stm_p8_TUNE_L1_I2L8_v59_epoch=2-step=47297/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_I8L8_v60/pred_BAS_smt_it_stm_p8_TUNE_L1_I8L8_v60_epoch=1-step=31531/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_RAW_v58/pred_BAS_smt_it_stm_p8_TUNE_L1_RAW_v58_epoch=3-step=81135/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_RAW_v58/pred_BAS_smt_it_stm_p8_TUNE_L1_RAW_v58_epoch=8-step=182555/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_L1_DIL_v55/pred_BOTH_smt_it_stm_p8_L1_DIL_v55_epoch=5-step=53819/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
]

NAMEK_TO_EVALUATE_SC = [
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_st_s12_newanns_weighted_pfnorm_rgb_v25/pred_SC_smt_it_st_s12_newanns_weighted_pfnorm_rgb_v25_epoch=13-step=599381/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_centerannot_raw_v42/pred_SC_smt_it_stm_p8_centerannot_raw_v42_epoch=13-step=208753/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_centerannot_raw_v42/pred_SC_smt_it_stm_p8_centerannot_raw_v42_epoch=3-step=59643/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_centerannot_raw_v42/pred_SC_smt_it_stm_p8_centerannot_raw_v42_epoch=5-step=89465/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_centerannot_raw_v42/pred_SC_smt_it_stm_p8_centerannot_raw_v42_epoch=55-step=835015/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_centerannot_raw_v42/pred_SC_smt_it_stm_p8_centerannot_raw_v42_epoch=7-step=119287/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_cs64_t5_perframe_rgb_v30/pred_SC_smt_it_stm_p8_newanns_cs64_t5_perframe_rgb_v30_epoch=26-step=1155950/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_cs96_t3_perframe_rgb_v28/pred_SC_smt_it_stm_p8_newanns_cs96_t3_perframe_rgb_v28_epoch=51-step=1274623/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_cs96_t3_perframe_rgb_v28/pred_SC_smt_it_stm_p8_newanns_cs96_t3_perframe_rgb_v28_epoch=57-step=1421695/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_mat6raw6_v41/pred_SC_smt_it_stm_p8_newanns_weighted_mat6raw6_v41_epoch=27-step=1198763/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_mat6raw6_v41/pred_SC_smt_it_stm_p8_newanns_weighted_mat6raw6_v41_epoch=32-step=1412828/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_mat6raw6_v41/pred_SC_smt_it_stm_p8_newanns_weighted_mat6raw6_v41_epoch=42-step=1840958/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v38/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v38_epoch=85-step=3681917/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v39/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v39_epoch=13-step=599381/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v39/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v39_epoch=23-step=1027511/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v39/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v39_epoch=46-step=2012210/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v39/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v39_epoch=52-step=2269088/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v39/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v39_epoch=66-step=2868470/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_raw_v39/pred_SC_smt_it_stm_p8_newanns_weighted_raw_v39_epoch=67-step=2911283/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_rgb_v26/pred_SC_smt_it_stm_p8_newanns_weighted_rgb_v26_epoch=66-step=2868470/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/SC_smt_it_stm_p8_newanns_weighted_rgb_v26/pred_SC_smt_it_stm_p8_newanns_weighted_rgb_v26_epoch=92-step=3981608/Drop1-Aligned-L1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
]



BEST_MODELS = [

    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TUNE_L1_RAW_v58/pred_BAS_smt_it_stm_p8_TUNE_L1_RAW_v58_epoch=3-step=81135/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',

    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_L1_DIL_v55/pred_BOTH_smt_it_stm_p8_L1_DIL_v55_epoch=5-step=53819/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',
]


TO_EVALUATE = [
    # '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TA1_raw_v54/pred_BAS_smt_it_stm_p8_TA1_raw_v54_epoch=13-step=242605/Drop1-Aligned-TA1-2022-01_vali_data_nowv.kwcoco/pred.kwcoco.json',
    # '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_TA1_raw_v54/pred_BAS_smt_it_stm_p8_TA1_raw_v54_epoch=13-step=242605/Drop2-Aligned-TA1-2022-01_data_nowv_vali.kwcoco/pred.kwcoco.json',
    '/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BAS_smt_it_stm_p8_L1_raw_v53/pred_BAS_smt_it_stm_p8_L1_raw_v53_epoch=15-step=340047/Drop1-Aligned-L1-2022-01_combo_DILM_nowv_vali.kwcoco/pred.kwcoco.json',

]


def main():
    run = 1

    import watch
    import ubelt as ub
    from watch.utils import tmux_queue
    dvc_dpath = watch.find_smart_dvc_dpath()
    tmux_schedule_dpath = dvc_dpath / '_tmp_tmux_schedule'
    tmux_schedule_dpath.ensuredir()

    environ = {
        'DVC_DPATH': dvc_dpath,
    }

    IARPA_METRICS_DPATH = ub.cmd(
        'python -c "import iarpa_smart_metrics, ubelt; '
        'print(ubelt.Path(iarpa_smart_metrics.__file__).parent.parent)"')['out'].strip()

    task = 'bas'
    # task = 'sc'
    recompute_eval = 0
    skip_existing = 1

    # if task == 'sc':
    #     TO_EVALUATE = [if 'SC' in TO_EVALUATE]
    expected_outputs = []
    stamp = ub.timestamp() + '_' + ub.hash_data([])[0:8]
    tq = tmux_queue.TMUXMultiQueue(
        name=stamp, size=5, environ=environ,
        dpath=tmux_schedule_dpath)

    import numpy as np
    track_kwargs_basis = {
        'thresh': np.linspace(0.1, 0.4, 10).round(3).tolist(),
        # 'thresh': np.linspace(0.17, 0.22, 5).round(3).tolist(),
    }
    for track_kwargs in ub.named_product(track_kwargs_basis):
        for pred_fpath in TO_EVALUATE:
            pred_fpath = ub.Path(pred_fpath)
            pred_bundle_dpath = pred_fpath.parent

            if task == 'bas':
                import shlex
                import json
                track_kwargs_str = shlex.quote(json.dumps(track_kwargs))
                bas_args = f'--track_fn watch.tasks.tracking.from_heatmap.TimeAggregatedBAS --track_kwargs {track_kwargs_str}'  # NOQA
                task_args = bas_args
            elif task == 'sc':
                sc_args = r'--track_fn watch.tasks.tracking.from_heatmap.TimeAggregatedHybrid --track_kwargs "{\"coco_dset_sc\": \"' + str(pred_fpath) + r'\"}"'  # NOQA
                task_args = bas_args
            else:
                raise KeyError

            suffix = 'task-' + ub.repr2(track_kwargs, compact=1)
            IARPA_EVAL_DPATH = pred_bundle_dpath / f'eval/iarpa-{suffix}'
            summary_fpath = IARPA_EVAL_DPATH / 'scores/merged/summary2.json'
            expected_outputs.append(summary_fpath)

            command = ub.codeblock(
                fr'''
                python -m watch.cli.kwcoco_to_geojson \
                    "{pred_fpath}" \
                     {task_args} \
                    --out_dir "{IARPA_EVAL_DPATH}/tracked_sites" \
                    score  -- \
                        --merge \
                        --gt_dpath "{dvc_dpath}/annotations" \
                        --metrics_dpath "{IARPA_METRICS_DPATH}" \
                        --tmp_dir "{IARPA_EVAL_DPATH}/tmp" \
                        --out_dir "{IARPA_EVAL_DPATH}/scores"
                ''')

            if recompute_eval or not (skip_existing and summary_fpath.exists()):
                tq.submit(command)

    print('tq = {!r}'.format(tq))
    tq.rprint()

    if run:
        # ub.cmd('bash ' + str(driver_fpath), verbose=3, check=True)
        tq.run()
        tq.monitor()
    else:
        driver_fpath = tq.write()
        print('Wrote script: to run execute:\n{}'.format(driver_fpath))

    # if IARPA_EVAL_DPATH.exists():
    #     print(IARPA_EVAL_DPATH)
    #     break

    # expected_outputs = []
    # for pred_fpath in TO_EVALUATE:
    #     pred_fpath = ub.Path(pred_fpath)
    #     pred_bundle_dpath = pred_fpath.parent
    #     IARPA_EVAL_DPATH = pred_bundle_dpath / 'eval/iarpa'
    #     summary_fpath = IARPA_EVAL_DPATH / 'scores/merged/summary2.json'
    #     expected_outputs.append(summary_fpath)

    have_outputs = [s for s in expected_outputs if s.exists()]
    have_outputs[0].exists()
    import json
    import pandas as pd

    rows = []
    for summary_fpath in have_outputs:
        summary_text = summary_fpath.read_text()
        if not summary_text:
            print('bad summary_fpath = {!r}'.format(summary_fpath))
        else:
            # hack to get thresh:
            import parse
            thresh = float(parse.parse('{}thresh={thresh}/{}', str(summary_fpath)).named['thresh'])

            summary = json.loads(summary_text)

            pred_bundle_dpath = summary_fpath.parent.parent.parent.parent.parent
            # dataset_key = pred_bundle_dpath.name
            model_key = pred_bundle_dpath.parent.name

            best_bas_rows = pd.read_json(json.dumps(summary['best_bas_rows']), orient='table')
            merged_row = best_bas_rows.loc['merged']
            merged_subrow = merged_row[['F1']]
            merged_subrow = merged_subrow.assign(thresh=thresh)
            merged_subrow = merged_subrow.assign(model=[model_key])
            merged_subrow = merged_subrow.reset_index()

            # merged_subrow = merged_subrow.assign(dataset=[dataset_key])
            rows.append(merged_subrow)
    summary_df = pd.concat(rows)
    summary_df = summary_df.sort_values('F1')
    summary_df = summary_df.sort_values('thresh')
    print(summary_df.to_string())
    summary_df = summary_df.iloc[3:]
    print(summary_df.to_string())

    if 1:
        import dataframe_image as dfi
        dfi.export(
            summary_df,
            "./tmp.png",
            table_conversion="chrome",
            fontsize=28,
            max_rows=-1,
        )
        import kwplot
        fig, _ = kwplot.imshow('./tmp.png', fnum=10)
        fig.tight_layout()
        kwplot.autompl()
        kwplot.imshow('./tmp.png', fnum=101)


"""

HACK

PRED_BUNDLE_DPATH="/home/joncrall/data/dvc-repos/smart_watch_dvc/models/fusion/SC-20201117/BOTH_smt_it_stm_p8_L1_DIL_v55/pred_BOTH_smt_it_stm_p8_L1_DIL_v55_epoch=6-step=62789/combo_DILM.kwcoco_vali"
PRED_DATASET="$PRED_BUNDLE_DPATH/pred.kwcoco.json"
EVAL_DPATH="$PRED_BUNDLE_DPATH/eval"
IARPA_EVAL_DPATH="$EVAL_DPATH/iarpa-sc-thresh-0.1"
IARPA_METRICS_DPATH=$(python -c "import iarpa_smart_metrics, os; print(os.path.dirname(os.path.dirname(iarpa_smart_metrics.__file__)))")

REGION_FILE=/home/joncrall/data/dvc-repos/smart_watch_dvc/annotations/region_models/KR_R002.geojson

echo $PRED_DATASET
echo $REGION_FILE

python -m watch.cli.kwcoco_to_geojson \
    "$PRED_DATASET" \
    --track_fn watch.tasks.tracking.from_heatmap.TimeAggregatedSC --track_kwargs "{\"thresh\": 0.01}" \
    --site_summary $REGION_FILE \
    score  -- \
        --merge \
        --gt_dpath "$DVC_DPATH/annotations" \
        --metrics_dpath "$IARPA_METRICS_DPATH" \
        --tmp_dir "$IARPA_EVAL_DPATH/tmp" \
        --out_dir "$IARPA_EVAL_DPATH/scores"

nautilus $IARPA_EVAL_DPATH


python -m watch.cli.kwcoco_to_geojson \
    "$PRED_DATASET" \
    --default_track_fn watch.tasks.tracking.from_heatmap.TimeAggregatedSC --track_kwargs "{\"thresh\": 0.01}" \
    score  -- \
        --merge \
        --gt_dpath "$DVC_DPATH/annotations" \
        --metrics_dpath "$IARPA_METRICS_DPATH" \
        --tmp_dir "$IARPA_EVAL_DPATH/tmp" \
        --out_dir "$IARPA_EVAL_DPATH/scores"
"""
