{
  "$id": "site-model.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "definitions": {
    "geojson_coordinates": {
      "description": "A longitude/latitude pair of coordinates",
      "items": {
        "type": "number"
      },
      "minItems": 2,
      "maxItems": 2,
      "type": "array"
    },
    "geojson_ring": {
      "description": "A list of coordinate pairs, describing a perimeter",
      "items": {
        "$ref": "#/definitions/geojson_coordinates"
      },
      "minItems": 4,
      "type": "array"
    },
    "geojson_polygon": {
      "description": "A list of geojson rings, encoding a perimeter and zero or more voids within the polygon",
      "items": {
        "$ref": "#/definitions/geojson_ring"
      },
      "minItems": 1,
      "type": "array"
    },
    "geojson_multipolygon": {
      "description": "A list of geojson polygons, encoding a collection of polygons",
      "items": {
        "$ref": "#/definitions/geojson_polygon"
      },
      "minItems": 1,
      "type": "array"
    },
    "polygon": {
      "description": "a GeoJSON spec compliant Polygon object",
      "properties": {
        "coordinates": {
          "$ref": "#/definitions/geojson_polygon"
        },
        "type": {
          "const": "Polygon",
          "type": "string"
        }
      },
      "required": [
        "type",
        "coordinates"
      ],
      "type": "object"
    },
    "multipolygon": {
      "description": "a GeoJSON spec compliant MultiPolygon object",
      "properties": {
        "type": {
          "const": "MultiPolygon",
          "type": "string"
        },
        "coordinates": {
          "$ref": "#/definitions/geojson_multipolygon"
        }
      },
      "required": [
        "type",
        "coordinates"
      ],
      "type": "object"
    },
    "_site_properties": {
      "properties": {
        "type": {"const": "site", "type": "string"},
        "version": {"type": "string", "pattern": "^\\d+\\.\\d+\\.\\d+$"},
        "mgrs": {"type": "string", "pattern": "[0-9]{2}[A-Z]{3}"},
        "status": {"type": "string"},
        "model_content": {"enum": ["annotation", "proposed"]},
        "start_date": {"oneOf": [{"type": "null"}, {"type": "string", "format": "date"}]},
        "end_date": {"oneOf": [{"type": "null"}, {"type": "string", "format": "date"}]},
        "originator": {"enum": ["te", "pmo", "acc", "ara", "ast", "bla", "iai", "kit", "str", "iMERIT"]},
        "score": {"type": "number", "minimum": 0, "maximum": 1},
        "validated": {"enum": ["True", "False"]},
        "predicted_phase_transition": {"enum": ["Active Construction", "Post Construction"]},
        "predicted_phase_transition_date": {"type": "string", "format": "date"},
        "misc_info": {"type": "object"}
      },
      "required": [
        "type", "region_id", "site_id", "version", "mgrs", "model_content", "start_date", "end_date", "status", "originator"
      ]
    },
    "unassociated_site_properties": {
      "allOf": [{"$ref": "#/definitions/_site_properties"}],
      "properties": {
        "region_id": {"type": "null"}, 
        "site_id": {"type": "string", "pattern": "^[A-Z]{2}_[RC]x{3}_[0-9]{4}$"}
      }
    },
    "associated_site_properties": {
      "allOf": [{"$ref": "#/definitions/_site_properties"}],
      "properties": {
        "region_id": {"type": "string", "pattern": "^[A-Z]{2}_[RCS][0-9]{3}$"},
        "site_id": {"type": "string", "pattern": "^[A-Z]{2}_[RC][0-9]{3}_[0-9]{4}$"}
      }
    },
    "observation_properties": {
      "properties": {
        "type": {"const": "observation", "type": "string"},
        "observation_date": {"oneOf": [{"type": "null"}, {"type": "string", "format": "date"}]},
        "source": {"oneOf": [{"type": "null"}, {"type": "string"}]},
        "sensor_name": {"oneOf": [{"type": "null"}, {"enum": ["Landsat 8", "Sentinel-2", "WorldView", "Planet"]}]},
        "current_phase": {"oneOf": [{"type": "null"}, {"type": "string", "pattern": "^((No Activity|Site Preparation|Active Construction|Post Construction|Unknown),* *)+$"}]},
        "is_occluded": {"oneOf": [{"type": "null"}, {"type": "string", "pattern": "^((True|False),* *)+$"}]},
        "is_site_boundary": {"oneOf": [{"type": "null"}, {"type": "string", "pattern": "^((True|False),* *)+$"}]},
        "score": {"type": "number", "minimum": 0, "maximum": 1},
        "misc_info": {"type": "object"}
      },
      "required": [
        "type", "observation_date", "source", "sensor_name", "current_phase", "is_occluded", "is_site_boundary"
      ]
    }
  },
  "properties": {
    "features": {
      "items": {
        "anyOf": [
          {
            "properties": {
              "type":{
                "const": "Feature",
                "type": "string"
              },
              "properties": {
                "oneOf": [
                  {"$ref": "#/definitions/unassociated_site_properties"},
                  {"$ref": "#/definitions/associated_site_properties"}
                ]},
              "geometry": {"$ref": "#/definitions/polygon"}
            },
            "required": [
              "type", "geometry", "properties"
            ]
          },
          {
            "properties": {
              "type":{
                "const": "Feature",
                "type": "string"
              },
              "properties": {
                "$ref": "#/definitions/observation_properties"
              },
              "geometry": {
                "oneOf": [
                  {"$ref": "#/definitions/polygon"},
                  {"$ref": "#/definitions/multipolygon"}
                ]
              }
            },
            "required": [
              "type", "geometry", "properties"
            ]
          }
        ]
      }
    },
    "type": {
      "const": "FeatureCollection",
      "type": "string"
    }
  },
  "required": [
    "type",
    "features"
  ],
  "title": "Site Model object",
  "type": "object"
}
